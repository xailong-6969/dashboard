datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../apps/web/node_modules/.prisma/client"
}

model Market {
  marketId        BigInt    @id
  configUri       String?
  configUriHash   String?
  createdAtBlock  BigInt?
  createdAtTime   DateTime?
  modelsJson      Json?
  winningModelIdx BigInt?
  status          Int       @default(0)
  trades          Trade[]

  @@index([status])
  @@index([createdAtTime])
}

model Trade {
  id              String   @id
  txHash          String
  logIndex        Int
  blockNumber     BigInt
  blockTime       DateTime
  marketId        BigInt
  modelIdx        BigInt
  trader          String
  isBuy           Boolean
  tokensDelta     String
  sharesDelta     String
  modelNewPrice   String
  modelNewSupply  String
  marketNewSupply String
  market          Market   @relation(fields: [marketId], references: [marketId])

  @@index([marketId, blockTime])
  @@index([trader, blockTime])
  @@index([txHash])
  @@index([blockTime])
  @@index([isBuy, blockTime])
}

model IndexerState {
  id        String   @id @default("delphi")
  lastBlock BigInt
  updatedAt DateTime @updatedAt
}

model DailyStats {
  id            String   @id
  date          DateTime @unique
  totalTrades   Int      @default(0)
  totalVolume   String   @default("0")
  uniqueTraders Int      @default(0)
  buyCount      Int      @default(0)
  sellCount     Int      @default(0)

  @@index([date])
}
