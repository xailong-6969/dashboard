datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../apps/web/node_modules/.prisma/client"
}

model Market {
  marketId        BigInt   @id
  configUri       String?
  configUriHash   String?
  createdAtBlock  BigInt?
  createdAtTime   DateTime?
  modelsJson      Json?
  winningModelIdx BigInt?
  status          Int?
  trades          Trade[]
}

model Trade {
  id              String   @id
  txHash          String
  logIndex        Int
  blockNumber     BigInt
  blockTime       DateTime
  marketId        BigInt
  modelIdx        BigInt
  trader          String
  isBuy           Boolean
  tokensDelta     String
  sharesDelta     String
  modelNewPrice   String
  modelNewSupply  String
  marketNewSupply String
  market          Market   @relation(fields: [marketId], references: [marketId])

  @@index([marketId, blockTime])
  @@index([trader, blockTime])
  @@index([txHash])
}

model IndexerState {
  id        String   @id @default("delphi")
  lastBlock BigInt
  updatedAt DateTime @updatedAt
}
